# test_3 
# Answer: OK
# Description: test with several vertex templates. Testing auto name generation for
# vertices made with vertex templates

<graph>

	version = 1.0

	<header>
		@
			some code here
		@
	</header>

	<root>
		root = "root"
	</root>

	<tail>
		@
			some code here
		@
	</tail>

	<parameters>
		var i = ("1" "2")
		var j = ("2" "3")
	</parameters>
	
	main_subgraph = "sub_1"

	<subgraph>
		name = "sub_1"

		condition = @ some code here @

		<vertex>
			name = "sub_1_vert_1"
			
			<code>
				@
					some code here
				@
			</code>
			
			<exchange>	
				name = "ex_1"
				send = "int_1"
				send = "int_2"
			</exchange>
		</vertex>

		<vertex>
			name = "sub_1_vert_2"
			<code>
				@
					smdks
				@
			</code>

			<exchange>
				name = "ex_1"
				recv = "int_1"
				send = "ext_1"
			</exchange>
		</vertex>

		<vertex>
			name = "sub_1_vert_3"
			
			<code>
				@
					dwd
				@
			</code>

			<exchange>
				name = "ex_1"
				recv = "int_2"
				send = "cont_1"
			</exchange>
		</vertex>

		<control_edge>
			name = "cont_1"
			template = "edge_template_1"
			send = ("sub_1_vert_3", "ex_1")	
		</control_edge>

		<internal_edge>
			using i, j;
			name = "int_%i%"
			template = "edge_template"
			send= ("sub_1_vert_1", "ex_1")
			recv = ("sub_1_vert_%j%", "ex_1")
		</internal_edge>
		
	</subgraph>

	<subgraph>
		name = "sub_2"
		condition = @ some code here @

		<vertex>
			name = "sub_2_vert_1"

			<code>
				@
					kd
				@
			</code>

			<exchange>
				name = "ex_1"
				send = "int_1"
				send = "int_2"
			</exchange>
					
		</vertex>

		<vertex>
			name = "sub_2_vert_2"

			<code>
				@
					sfe
				@
			</code>
	
			<exchange>
				name = "ex_1"
				recv = "int_1"
				recv = "ext_1"
			</exchange>
		</vertex>

		<vertex>
			name = "sub_2_vert_3"

			<code>
				@
					jnfkn
				@
			</code>
	
			<exchange>
				name = "ex_1"
				recv = "int_2"
			</exchange>
		</vertex>

		<internal_edge>
			using i, j;
			name = "int_%i%"
			template = "edge_template"
			send= ("sub_2_vert_1", "ex_1")
			recv = ("sub_2_vert_%j%", "ex_1")
		</internal_edge>


	</subgraph>

	<edge_template>
	    name="edge_template"
		 <send>   
		    <fragment>
		        variable = @ some code here @
		        type     = @ some code here @
		        left     = @ some code here @
		        right    = @ some code here @
		    </fragment>
		 </send>
	
		 <recv>
		    <fragment>
		        variable = @ some code here @
		        type     = @ some code here @
		        left     = @ some code here @
		        right    = @ some code here @
		    </fragment>
		 </recv>
	</edge_template>

	<external_edge>
		name = "ext_1"
		template = "edge_template"
		send = ("sub_1", "sub_1_vert_2", "ex_1")
		recv = ("sub_2", "sub_2_vert_2", "ex_1")
	</external_edge>
</graph>

